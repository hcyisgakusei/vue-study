{"remainingRequest":"/Users/tech/workspace/demo/vue-demo/node_modules/babel-loader/lib/index.js!/Users/tech/workspace/demo/vue-demo/src/vueResource/core/vdom/patch.js","dependencies":[{"path":"/Users/tech/workspace/demo/vue-demo/src/vueResource/core/vdom/patch.js","mtime":1597386046256},{"path":"/Users/tech/workspace/demo/vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tech/workspace/demo/vue-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKCi8qKgogKiBWaXJ0dWFsIERPTSBwYXRjaGluZyBhbGdvcml0aG0gYmFzZWQgb24gU25hYmJkb20gYnkKICogU2ltb24gRnJpaXMgVmluZHVtIChAcGFsZGVwaW5kKQogKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UKICogaHR0cHM6Ly9naXRodWIuY29tL3BhbGRlcGluZC9zbmFiYmRvbS9ibG9iL21hc3Rlci9MSUNFTlNFCiAqCiAqIG1vZGlmaWVkIGJ5IEV2YW4gWW91IChAeXl4OTkwODAzKQogKgogKiBOb3QgdHlwZS1jaGVja2luZyB0aGlzIGJlY2F1c2UgdGhpcyBmaWxlIGlzIHBlcmYtY3JpdGljYWwgYW5kIHRoZSBjb3N0CiAqIG9mIG1ha2luZyBmbG93IHVuZGVyc3RhbmQgaXQgaXMgbm90IHdvcnRoIGl0LgogKi8KaW1wb3J0IFZOb2RlLCB7IGNsb25lVk5vZGUgfSBmcm9tICcuL3Zub2RlJzsKaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcnOwppbXBvcnQgeyBTU1JfQVRUUiB9IGZyb20gJy4uLy4uL3NoYXJlZC9jb25zdGFudHMnOwppbXBvcnQgeyByZWdpc3RlclJlZiB9IGZyb20gJy4vbW9kdWxlcy9yZWYnOwppbXBvcnQgeyB0cmF2ZXJzZSB9IGZyb20gJy4uL29ic2VydmVyL3RyYXZlcnNlJzsKaW1wb3J0IHsgYWN0aXZlSW5zdGFuY2UgfSBmcm9tICcuLi9pbnN0YW5jZS9saWZlY3ljbGUnOwppbXBvcnQgeyBpc1RleHRJbnB1dFR5cGUgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybXMvd2ViL3V0aWwvZWxlbWVudCc7CmltcG9ydCB7IHdhcm4sIGlzRGVmLCBpc1VuZGVmLCBpc1RydWUsIG1ha2VNYXAsIGlzUmVnRXhwLCBpc1ByaW1pdGl2ZSB9IGZyb20gJy4uL3V0aWwvaW5kZXgnOwpleHBvcnQgdmFyIGVtcHR5Tm9kZSA9IG5ldyBWTm9kZSgnJywge30sIFtdKTsKdmFyIGhvb2tzID0gWydjcmVhdGUnLCAnYWN0aXZhdGUnLCAndXBkYXRlJywgJ3JlbW92ZScsICdkZXN0cm95J107CgpmdW5jdGlvbiBzYW1lVm5vZGUoYSwgYikgewogIHJldHVybiBhLmtleSA9PT0gYi5rZXkgJiYgKGEudGFnID09PSBiLnRhZyAmJiBhLmlzQ29tbWVudCA9PT0gYi5pc0NvbW1lbnQgJiYgaXNEZWYoYS5kYXRhKSA9PT0gaXNEZWYoYi5kYXRhKSAmJiBzYW1lSW5wdXRUeXBlKGEsIGIpIHx8IGlzVHJ1ZShhLmlzQXN5bmNQbGFjZWhvbGRlcikgJiYgYS5hc3luY0ZhY3RvcnkgPT09IGIuYXN5bmNGYWN0b3J5ICYmIGlzVW5kZWYoYi5hc3luY0ZhY3RvcnkuZXJyb3IpKTsKfQoKZnVuY3Rpb24gc2FtZUlucHV0VHlwZShhLCBiKSB7CiAgaWYgKGEudGFnICE9PSAnaW5wdXQnKSByZXR1cm4gdHJ1ZTsKICB2YXIgaTsKICB2YXIgdHlwZUEgPSBpc0RlZihpID0gYS5kYXRhKSAmJiBpc0RlZihpID0gaS5hdHRycykgJiYgaS50eXBlOwogIHZhciB0eXBlQiA9IGlzRGVmKGkgPSBiLmRhdGEpICYmIGlzRGVmKGkgPSBpLmF0dHJzKSAmJiBpLnR5cGU7CiAgcmV0dXJuIHR5cGVBID09PSB0eXBlQiB8fCBpc1RleHRJbnB1dFR5cGUodHlwZUEpICYmIGlzVGV4dElucHV0VHlwZSh0eXBlQik7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUtleVRvT2xkSWR4KGNoaWxkcmVuLCBiZWdpbklkeCwgZW5kSWR4KSB7CiAgdmFyIGksIGtleTsKICB2YXIgbWFwID0ge307CgogIGZvciAoaSA9IGJlZ2luSWR4OyBpIDw9IGVuZElkeDsgKytpKSB7CiAgICBrZXkgPSBjaGlsZHJlbltpXS5rZXk7CiAgICBpZiAoaXNEZWYoa2V5KSkgbWFwW2tleV0gPSBpOwogIH0KCiAgcmV0dXJuIG1hcDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBhdGNoRnVuY3Rpb24oYmFja2VuZCkgewogIHZhciBpLCBqOwogIHZhciBjYnMgPSB7fTsKICB2YXIgbW9kdWxlcyA9IGJhY2tlbmQubW9kdWxlcywKICAgICAgbm9kZU9wcyA9IGJhY2tlbmQubm9kZU9wczsKCiAgZm9yIChpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgKytpKSB7CiAgICBjYnNbaG9va3NbaV1dID0gW107CgogICAgZm9yIChqID0gMDsgaiA8IG1vZHVsZXMubGVuZ3RoOyArK2opIHsKICAgICAgaWYgKGlzRGVmKG1vZHVsZXNbal1baG9va3NbaV1dKSkgewogICAgICAgIGNic1tob29rc1tpXV0ucHVzaChtb2R1bGVzW2pdW2hvb2tzW2ldXSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGVtcHR5Tm9kZUF0KGVsbSkgewogICAgcmV0dXJuIG5ldyBWTm9kZShub2RlT3BzLnRhZ05hbWUoZWxtKS50b0xvd2VyQ2FzZSgpLCB7fSwgW10sIHVuZGVmaW5lZCwgZWxtKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVJtQ2IoY2hpbGRFbG0sIGxpc3RlbmVycykgewogICAgZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICBpZiAoLS1yZW1vdmUubGlzdGVuZXJzID09PSAwKSB7CiAgICAgICAgcmVtb3ZlTm9kZShjaGlsZEVsbSk7CiAgICAgIH0KICAgIH0KCiAgICByZW1vdmUubGlzdGVuZXJzID0gbGlzdGVuZXJzOwogICAgcmV0dXJuIHJlbW92ZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZU5vZGUoZWwpIHsKICAgIHZhciBwYXJlbnQgPSBub2RlT3BzLnBhcmVudE5vZGUoZWwpOyAvLyBlbGVtZW50IG1heSBoYXZlIGFscmVhZHkgYmVlbiByZW1vdmVkIGR1ZSB0byB2LWh0bWwgLyB2LXRleHQKCiAgICBpZiAoaXNEZWYocGFyZW50KSkgewogICAgICBub2RlT3BzLnJlbW92ZUNoaWxkKHBhcmVudCwgZWwpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNVbmtub3duRWxlbWVudCh2bm9kZSwgaW5WUHJlKSB7CiAgICByZXR1cm4gIWluVlByZSAmJiAhdm5vZGUubnMgJiYgIShjb25maWcuaWdub3JlZEVsZW1lbnRzLmxlbmd0aCAmJiBjb25maWcuaWdub3JlZEVsZW1lbnRzLnNvbWUoZnVuY3Rpb24gKGlnbm9yZSkgewogICAgICByZXR1cm4gaXNSZWdFeHAoaWdub3JlKSA/IGlnbm9yZS50ZXN0KHZub2RlLnRhZykgOiBpZ25vcmUgPT09IHZub2RlLnRhZzsKICAgIH0pKSAmJiBjb25maWcuaXNVbmtub3duRWxlbWVudCh2bm9kZS50YWcpOwogIH0KCiAgdmFyIGNyZWF0aW5nRWxtSW5WUHJlID0gMDsKCiAgZnVuY3Rpb24gY3JlYXRlRWxtKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtLCBuZXN0ZWQsIG93bmVyQXJyYXksIGluZGV4KSB7CiAgICBpZiAoaXNEZWYodm5vZGUuZWxtKSAmJiBpc0RlZihvd25lckFycmF5KSkgewogICAgICAvLyBUaGlzIHZub2RlIHdhcyB1c2VkIGluIGEgcHJldmlvdXMgcmVuZGVyIQogICAgICAvLyBub3cgaXQncyB1c2VkIGFzIGEgbmV3IG5vZGUsIG92ZXJ3cml0aW5nIGl0cyBlbG0gd291bGQgY2F1c2UKICAgICAgLy8gcG90ZW50aWFsIHBhdGNoIGVycm9ycyBkb3duIHRoZSByb2FkIHdoZW4gaXQncyB1c2VkIGFzIGFuIGluc2VydGlvbgogICAgICAvLyByZWZlcmVuY2Ugbm9kZS4gSW5zdGVhZCwgd2UgY2xvbmUgdGhlIG5vZGUgb24tZGVtYW5kIGJlZm9yZSBjcmVhdGluZwogICAgICAvLyBhc3NvY2lhdGVkIERPTSBlbGVtZW50IGZvciBpdC4KICAgICAgdm5vZGUgPSBvd25lckFycmF5W2luZGV4XSA9IGNsb25lVk5vZGUodm5vZGUpOwogICAgfQoKICAgIHZub2RlLmlzUm9vdEluc2VydCA9ICFuZXN0ZWQ7IC8vIGZvciB0cmFuc2l0aW9uIGVudGVyIGNoZWNrCgogICAgaWYgKGNyZWF0ZUNvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgIHZhciBjaGlsZHJlbiA9IHZub2RlLmNoaWxkcmVuOwogICAgdmFyIHRhZyA9IHZub2RlLnRhZzsKCiAgICBpZiAoaXNEZWYodGFnKSkgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIGlmIChkYXRhICYmIGRhdGEucHJlKSB7CiAgICAgICAgICBjcmVhdGluZ0VsbUluVlByZSsrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzVW5rbm93bkVsZW1lbnQodm5vZGUsIGNyZWF0aW5nRWxtSW5WUHJlKSkgewogICAgICAgICAgd2FybignVW5rbm93biBjdXN0b20gZWxlbWVudDogPCcgKyB0YWcgKyAnPiAtIGRpZCB5b3UgJyArICdyZWdpc3RlciB0aGUgY29tcG9uZW50IGNvcnJlY3RseT8gRm9yIHJlY3Vyc2l2ZSBjb21wb25lbnRzLCAnICsgJ21ha2Ugc3VyZSB0byBwcm92aWRlIHRoZSAibmFtZSIgb3B0aW9uLicsIHZub2RlLmNvbnRleHQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdm5vZGUuZWxtID0gdm5vZGUubnMgPyBub2RlT3BzLmNyZWF0ZUVsZW1lbnROUyh2bm9kZS5ucywgdGFnKSA6IG5vZGVPcHMuY3JlYXRlRWxlbWVudCh0YWcsIHZub2RlKTsKICAgICAgc2V0U2NvcGUodm5vZGUpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICAgIGlmICh3aW5kb3cuX19XRUVYX18pIHsKICAgICAgICAvLyBpbiBXZWV4LCB0aGUgZGVmYXVsdCBpbnNlcnRpb24gb3JkZXIgaXMgcGFyZW50LWZpcnN0LgogICAgICAgIC8vIExpc3QgaXRlbXMgY2FuIGJlIG9wdGltaXplZCB0byB1c2UgY2hpbGRyZW4tZmlyc3QgaW5zZXJ0aW9uCiAgICAgICAgLy8gd2l0aCBhcHBlbmQ9InRyZWUiLgogICAgICAgIHZhciBhcHBlbmRBc1RyZWUgPSBpc0RlZihkYXRhKSAmJiBpc1RydWUoZGF0YS5hcHBlbmRBc1RyZWUpOwoKICAgICAgICBpZiAoIWFwcGVuZEFzVHJlZSkgewogICAgICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgICAgIGludm9rZUNyZWF0ZUhvb2tzKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgICB9CgogICAgICAgIGNyZWF0ZUNoaWxkcmVuKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKCiAgICAgICAgaWYgKGFwcGVuZEFzVHJlZSkgewogICAgICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgICAgIGludm9rZUNyZWF0ZUhvb2tzKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3JlYXRlQ2hpbGRyZW4odm5vZGUsIGNoaWxkcmVuLCBpbnNlcnRlZFZub2RlUXVldWUpOwoKICAgICAgICBpZiAoaXNEZWYoZGF0YSkpIHsKICAgICAgICAgIGludm9rZUNyZWF0ZUhvb2tzKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0KCiAgICAgICAgaW5zZXJ0KHBhcmVudEVsbSwgdm5vZGUuZWxtLCByZWZFbG0pOwogICAgICB9CgogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBkYXRhICYmIGRhdGEucHJlKSB7CiAgICAgICAgY3JlYXRpbmdFbG1JblZQcmUtLTsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc1RydWUodm5vZGUuaXNDb21tZW50KSkgewogICAgICB2bm9kZS5lbG0gPSBub2RlT3BzLmNyZWF0ZUNvbW1lbnQodm5vZGUudGV4dCk7CiAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgIH0gZWxzZSB7CiAgICAgIHZub2RlLmVsbSA9IG5vZGVPcHMuY3JlYXRlVGV4dE5vZGUodm5vZGUudGV4dCk7CiAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSkgewogICAgdmFyIGkgPSB2bm9kZS5kYXRhOwoKICAgIGlmIChpc0RlZihpKSkgewogICAgICB2YXIgaXNSZWFjdGl2YXRlZCA9IGlzRGVmKHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSAmJiBpLmtlZXBBbGl2ZTsKCiAgICAgIGlmIChpc0RlZihpID0gaS5ob29rKSAmJiBpc0RlZihpID0gaS5pbml0KSkgewogICAgICAgIGkodm5vZGUsIGZhbHNlCiAgICAgICAgLyogaHlkcmF0aW5nICovCiAgICAgICAgKTsKICAgICAgfSAvLyBhZnRlciBjYWxsaW5nIHRoZSBpbml0IGhvb2ssIGlmIHRoZSB2bm9kZSBpcyBhIGNoaWxkIGNvbXBvbmVudAogICAgICAvLyBpdCBzaG91bGQndmUgY3JlYXRlZCBhIGNoaWxkIGluc3RhbmNlIGFuZCBtb3VudGVkIGl0LiB0aGUgY2hpbGQKICAgICAgLy8gY29tcG9uZW50IGFsc28gaGFzIHNldCB0aGUgcGxhY2Vob2xkZXIgdm5vZGUncyBlbG0uCiAgICAgIC8vIGluIHRoYXQgY2FzZSB3ZSBjYW4ganVzdCByZXR1cm4gdGhlIGVsZW1lbnQgYW5kIGJlIGRvbmUuCgoKICAgICAgaWYgKGlzRGVmKHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSkgewogICAgICAgIGluaXRDb21wb25lbnQodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgaW5zZXJ0KHBhcmVudEVsbSwgdm5vZGUuZWxtLCByZWZFbG0pOwoKICAgICAgICBpZiAoaXNUcnVlKGlzUmVhY3RpdmF0ZWQpKSB7CiAgICAgICAgICByZWFjdGl2YXRlQ29tcG9uZW50KHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0Q29tcG9uZW50KHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgIGlmIChpc0RlZih2bm9kZS5kYXRhLnBlbmRpbmdJbnNlcnQpKSB7CiAgICAgIGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoLmFwcGx5KGluc2VydGVkVm5vZGVRdWV1ZSwgdm5vZGUuZGF0YS5wZW5kaW5nSW5zZXJ0KTsKICAgICAgdm5vZGUuZGF0YS5wZW5kaW5nSW5zZXJ0ID0gbnVsbDsKICAgIH0KCiAgICB2bm9kZS5lbG0gPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZS4kZWw7CgogICAgaWYgKGlzUGF0Y2hhYmxlKHZub2RlKSkgewogICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgc2V0U2NvcGUodm5vZGUpOwogICAgfSBlbHNlIHsKICAgICAgLy8gZW1wdHkgY29tcG9uZW50IHJvb3QuCiAgICAgIC8vIHNraXAgYWxsIGVsZW1lbnQtcmVsYXRlZCBtb2R1bGVzIGV4Y2VwdCBmb3IgcmVmICgjMzQ1NSkKICAgICAgcmVnaXN0ZXJSZWYodm5vZGUpOyAvLyBtYWtlIHN1cmUgdG8gaW52b2tlIHRoZSBpbnNlcnQgaG9vawoKICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLnB1c2godm5vZGUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVhY3RpdmF0ZUNvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSkgewogICAgdmFyIGk7IC8vIGhhY2sgZm9yICM0MzM5OiBhIHJlYWN0aXZhdGVkIGNvbXBvbmVudCB3aXRoIGlubmVyIHRyYW5zaXRpb24KICAgIC8vIGRvZXMgbm90IHRyaWdnZXIgYmVjYXVzZSB0aGUgaW5uZXIgbm9kZSdzIGNyZWF0ZWQgaG9va3MgYXJlIG5vdCBjYWxsZWQKICAgIC8vIGFnYWluLiBJdCdzIG5vdCBpZGVhbCB0byBpbnZvbHZlIG1vZHVsZS1zcGVjaWZpYyBsb2dpYyBpbiBoZXJlIGJ1dAogICAgLy8gdGhlcmUgZG9lc24ndCBzZWVtIHRvIGJlIGEgYmV0dGVyIHdheSB0byBkbyBpdC4KCiAgICB2YXIgaW5uZXJOb2RlID0gdm5vZGU7CgogICAgd2hpbGUgKGlubmVyTm9kZS5jb21wb25lbnRJbnN0YW5jZSkgewogICAgICBpbm5lck5vZGUgPSBpbm5lck5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlOwoKICAgICAgaWYgKGlzRGVmKGkgPSBpbm5lck5vZGUuZGF0YSkgJiYgaXNEZWYoaSA9IGkudHJhbnNpdGlvbikpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2JzLmFjdGl2YXRlLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBjYnMuYWN0aXZhdGVbaV0oZW1wdHlOb2RlLCBpbm5lck5vZGUpOwogICAgICAgIH0KCiAgICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLnB1c2goaW5uZXJOb2RlKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfSAvLyB1bmxpa2UgYSBuZXdseSBjcmVhdGVkIGNvbXBvbmVudCwKICAgIC8vIGEgcmVhY3RpdmF0ZWQga2VlcC1hbGl2ZSBjb21wb25lbnQgZG9lc24ndCBpbnNlcnQgaXRzZWxmCgoKICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICB9CgogIGZ1bmN0aW9uIGluc2VydChwYXJlbnQsIGVsbSwgcmVmKSB7CiAgICBpZiAoaXNEZWYocGFyZW50KSkgewogICAgICBpZiAoaXNEZWYocmVmKSkgewogICAgICAgIGlmIChub2RlT3BzLnBhcmVudE5vZGUocmVmKSA9PT0gcGFyZW50KSB7CiAgICAgICAgICBub2RlT3BzLmluc2VydEJlZm9yZShwYXJlbnQsIGVsbSwgcmVmKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZU9wcy5hcHBlbmRDaGlsZChwYXJlbnQsIGVsbSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNoaWxkcmVuKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMoY2hpbGRyZW4pOwogICAgICB9CgogICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgY2hpbGRyZW4ubGVuZ3RoOyArK19pKSB7CiAgICAgICAgY3JlYXRlRWxtKGNoaWxkcmVuW19pXSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCB2bm9kZS5lbG0sIG51bGwsIHRydWUsIGNoaWxkcmVuLCBfaSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQcmltaXRpdmUodm5vZGUudGV4dCkpIHsKICAgICAgbm9kZU9wcy5hcHBlbmRDaGlsZCh2bm9kZS5lbG0sIG5vZGVPcHMuY3JlYXRlVGV4dE5vZGUoU3RyaW5nKHZub2RlLnRleHQpKSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpc1BhdGNoYWJsZSh2bm9kZSkgewogICAgd2hpbGUgKHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSB7CiAgICAgIHZub2RlID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlOwogICAgfQoKICAgIHJldHVybiBpc0RlZih2bm9kZS50YWcpOwogIH0KCiAgZnVuY3Rpb24gaW52b2tlQ3JlYXRlSG9va3Modm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSkgewogICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgY2JzLmNyZWF0ZS5sZW5ndGg7ICsrX2kyKSB7CiAgICAgIGNicy5jcmVhdGVbX2kyXShlbXB0eU5vZGUsIHZub2RlKTsKICAgIH0KCiAgICBpID0gdm5vZGUuZGF0YS5ob29rOyAvLyBSZXVzZSB2YXJpYWJsZQoKICAgIGlmIChpc0RlZihpKSkgewogICAgICBpZiAoaXNEZWYoaS5jcmVhdGUpKSBpLmNyZWF0ZShlbXB0eU5vZGUsIHZub2RlKTsKICAgICAgaWYgKGlzRGVmKGkuaW5zZXJ0KSkgaW5zZXJ0ZWRWbm9kZVF1ZXVlLnB1c2godm5vZGUpOwogICAgfQogIH0gLy8gc2V0IHNjb3BlIGlkIGF0dHJpYnV0ZSBmb3Igc2NvcGVkIENTUy4KICAvLyB0aGlzIGlzIGltcGxlbWVudGVkIGFzIGEgc3BlY2lhbCBjYXNlIHRvIGF2b2lkIHRoZSBvdmVyaGVhZAogIC8vIG9mIGdvaW5nIHRocm91Z2ggdGhlIG5vcm1hbCBhdHRyaWJ1dGUgcGF0Y2hpbmcgcHJvY2Vzcy4KCgogIGZ1bmN0aW9uIHNldFNjb3BlKHZub2RlKSB7CiAgICB2YXIgaTsKCiAgICBpZiAoaXNEZWYoaSA9IHZub2RlLmZuU2NvcGVJZCkpIHsKICAgICAgbm9kZU9wcy5zZXRTdHlsZVNjb3BlKHZub2RlLmVsbSwgaSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgYW5jZXN0b3IgPSB2bm9kZTsKCiAgICAgIHdoaWxlIChhbmNlc3RvcikgewogICAgICAgIGlmIChpc0RlZihpID0gYW5jZXN0b3IuY29udGV4dCkgJiYgaXNEZWYoaSA9IGkuJG9wdGlvbnMuX3Njb3BlSWQpKSB7CiAgICAgICAgICBub2RlT3BzLnNldFN0eWxlU2NvcGUodm5vZGUuZWxtLCBpKTsKICAgICAgICB9CgogICAgICAgIGFuY2VzdG9yID0gYW5jZXN0b3IucGFyZW50OwogICAgICB9CiAgICB9IC8vIGZvciBzbG90IGNvbnRlbnQgdGhleSBzaG91bGQgYWxzbyBnZXQgdGhlIHNjb3BlSWQgZnJvbSB0aGUgaG9zdCBpbnN0YW5jZS4KCgogICAgaWYgKGlzRGVmKGkgPSBhY3RpdmVJbnN0YW5jZSkgJiYgaSAhPT0gdm5vZGUuY29udGV4dCAmJiBpICE9PSB2bm9kZS5mbkNvbnRleHQgJiYgaXNEZWYoaSA9IGkuJG9wdGlvbnMuX3Njb3BlSWQpKSB7CiAgICAgIG5vZGVPcHMuc2V0U3R5bGVTY29wZSh2bm9kZS5lbG0sIGkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYWRkVm5vZGVzKHBhcmVudEVsbSwgcmVmRWxtLCB2bm9kZXMsIHN0YXJ0SWR4LCBlbmRJZHgsIGluc2VydGVkVm5vZGVRdWV1ZSkgewogICAgZm9yICg7IHN0YXJ0SWR4IDw9IGVuZElkeDsgKytzdGFydElkeCkgewogICAgICBjcmVhdGVFbG0odm5vZGVzW3N0YXJ0SWR4XSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSwgZmFsc2UsIHZub2Rlcywgc3RhcnRJZHgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW52b2tlRGVzdHJveUhvb2sodm5vZGUpIHsKICAgIHZhciBpLCBqOwogICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwoKICAgIGlmIChpc0RlZihkYXRhKSkgewogICAgICBpZiAoaXNEZWYoaSA9IGRhdGEuaG9vaykgJiYgaXNEZWYoaSA9IGkuZGVzdHJveSkpIGkodm5vZGUpOwoKICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5kZXN0cm95Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgY2JzLmRlc3Ryb3lbaV0odm5vZGUpOwogICAgICB9CiAgICB9CgogICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5jaGlsZHJlbikpIHsKICAgICAgZm9yIChqID0gMDsgaiA8IHZub2RlLmNoaWxkcmVuLmxlbmd0aDsgKytqKSB7CiAgICAgICAgaW52b2tlRGVzdHJveUhvb2sodm5vZGUuY2hpbGRyZW5bal0pOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZW1vdmVWbm9kZXMocGFyZW50RWxtLCB2bm9kZXMsIHN0YXJ0SWR4LCBlbmRJZHgpIHsKICAgIGZvciAoOyBzdGFydElkeCA8PSBlbmRJZHg7ICsrc3RhcnRJZHgpIHsKICAgICAgdmFyIGNoID0gdm5vZGVzW3N0YXJ0SWR4XTsKCiAgICAgIGlmIChpc0RlZihjaCkpIHsKICAgICAgICBpZiAoaXNEZWYoY2gudGFnKSkgewogICAgICAgICAgcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayhjaCk7CiAgICAgICAgICBpbnZva2VEZXN0cm95SG9vayhjaCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFRleHQgbm9kZQogICAgICAgICAgcmVtb3ZlTm9kZShjaC5lbG0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayh2bm9kZSwgcm0pIHsKICAgIGlmIChpc0RlZihybSkgfHwgaXNEZWYodm5vZGUuZGF0YSkpIHsKICAgICAgdmFyIF9pMzsKCiAgICAgIHZhciBsaXN0ZW5lcnMgPSBjYnMucmVtb3ZlLmxlbmd0aCArIDE7CgogICAgICBpZiAoaXNEZWYocm0pKSB7CiAgICAgICAgLy8gd2UgaGF2ZSBhIHJlY3Vyc2l2ZWx5IHBhc3NlZCBkb3duIHJtIGNhbGxiYWNrCiAgICAgICAgLy8gaW5jcmVhc2UgdGhlIGxpc3RlbmVycyBjb3VudAogICAgICAgIHJtLmxpc3RlbmVycyArPSBsaXN0ZW5lcnM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZGlyZWN0bHkgcmVtb3ZpbmcKICAgICAgICBybSA9IGNyZWF0ZVJtQ2Iodm5vZGUuZWxtLCBsaXN0ZW5lcnMpOwogICAgICB9IC8vIHJlY3Vyc2l2ZWx5IGludm9rZSBob29rcyBvbiBjaGlsZCBjb21wb25lbnQgcm9vdCBub2RlCgoKICAgICAgaWYgKGlzRGVmKF9pMyA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSAmJiBpc0RlZihfaTMgPSBfaTMuX3Zub2RlKSAmJiBpc0RlZihfaTMuZGF0YSkpIHsKICAgICAgICByZW1vdmVBbmRJbnZva2VSZW1vdmVIb29rKF9pMywgcm0pOwogICAgICB9CgogICAgICBmb3IgKF9pMyA9IDA7IF9pMyA8IGNicy5yZW1vdmUubGVuZ3RoOyArK19pMykgewogICAgICAgIGNicy5yZW1vdmVbX2kzXSh2bm9kZSwgcm0pOwogICAgICB9CgogICAgICBpZiAoaXNEZWYoX2kzID0gdm5vZGUuZGF0YS5ob29rKSAmJiBpc0RlZihfaTMgPSBfaTMucmVtb3ZlKSkgewogICAgICAgIF9pMyh2bm9kZSwgcm0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJtKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJlbW92ZU5vZGUodm5vZGUuZWxtKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUNoaWxkcmVuKHBhcmVudEVsbSwgb2xkQ2gsIG5ld0NoLCBpbnNlcnRlZFZub2RlUXVldWUsIHJlbW92ZU9ubHkpIHsKICAgIHZhciBvbGRTdGFydElkeCA9IDA7CiAgICB2YXIgbmV3U3RhcnRJZHggPSAwOwogICAgdmFyIG9sZEVuZElkeCA9IG9sZENoLmxlbmd0aCAtIDE7CiAgICB2YXIgb2xkU3RhcnRWbm9kZSA9IG9sZENoWzBdOwogICAgdmFyIG9sZEVuZFZub2RlID0gb2xkQ2hbb2xkRW5kSWR4XTsKICAgIHZhciBuZXdFbmRJZHggPSBuZXdDaC5sZW5ndGggLSAxOwogICAgdmFyIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFswXTsKICAgIHZhciBuZXdFbmRWbm9kZSA9IG5ld0NoW25ld0VuZElkeF07CiAgICB2YXIgb2xkS2V5VG9JZHgsIGlkeEluT2xkLCB2bm9kZVRvTW92ZSwgcmVmRWxtOyAvLyByZW1vdmVPbmx5IGlzIGEgc3BlY2lhbCBmbGFnIHVzZWQgb25seSBieSA8dHJhbnNpdGlvbi1ncm91cD4KICAgIC8vIHRvIGVuc3VyZSByZW1vdmVkIGVsZW1lbnRzIHN0YXkgaW4gY29ycmVjdCByZWxhdGl2ZSBwb3NpdGlvbnMKICAgIC8vIGR1cmluZyBsZWF2aW5nIHRyYW5zaXRpb25zCgogICAgdmFyIGNhbk1vdmUgPSAhcmVtb3ZlT25seTsKCiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBjaGVja0R1cGxpY2F0ZUtleXMobmV3Q2gpOwogICAgfQoKICAgIHdoaWxlIChvbGRTdGFydElkeCA8PSBvbGRFbmRJZHggJiYgbmV3U3RhcnRJZHggPD0gbmV3RW5kSWR4KSB7CiAgICAgIGlmIChpc1VuZGVmKG9sZFN0YXJ0Vm5vZGUpKSB7CiAgICAgICAgb2xkU3RhcnRWbm9kZSA9IG9sZENoWysrb2xkU3RhcnRJZHhdOyAvLyBWbm9kZSBoYXMgYmVlbiBtb3ZlZCBsZWZ0CiAgICAgIH0gZWxzZSBpZiAoaXNVbmRlZihvbGRFbmRWbm9kZSkpIHsKICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgfSBlbHNlIGlmIChzYW1lVm5vZGUob2xkU3RhcnRWbm9kZSwgbmV3U3RhcnRWbm9kZSkpIHsKICAgICAgICBwYXRjaFZub2RlKG9sZFN0YXJ0Vm5vZGUsIG5ld1N0YXJ0Vm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbmV3Q2gsIG5ld1N0YXJ0SWR4KTsKICAgICAgICBvbGRTdGFydFZub2RlID0gb2xkQ2hbKytvbGRTdGFydElkeF07CiAgICAgICAgbmV3U3RhcnRWbm9kZSA9IG5ld0NoWysrbmV3U3RhcnRJZHhdOwogICAgICB9IGVsc2UgaWYgKHNhbWVWbm9kZShvbGRFbmRWbm9kZSwgbmV3RW5kVm5vZGUpKSB7CiAgICAgICAgcGF0Y2hWbm9kZShvbGRFbmRWbm9kZSwgbmV3RW5kVm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbmV3Q2gsIG5ld0VuZElkeCk7CiAgICAgICAgb2xkRW5kVm5vZGUgPSBvbGRDaFstLW9sZEVuZElkeF07CiAgICAgICAgbmV3RW5kVm5vZGUgPSBuZXdDaFstLW5ld0VuZElkeF07CiAgICAgIH0gZWxzZSBpZiAoc2FtZVZub2RlKG9sZFN0YXJ0Vm5vZGUsIG5ld0VuZFZub2RlKSkgewogICAgICAgIC8vIFZub2RlIG1vdmVkIHJpZ2h0CiAgICAgICAgcGF0Y2hWbm9kZShvbGRTdGFydFZub2RlLCBuZXdFbmRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3RW5kSWR4KTsKICAgICAgICBjYW5Nb3ZlICYmIG5vZGVPcHMuaW5zZXJ0QmVmb3JlKHBhcmVudEVsbSwgb2xkU3RhcnRWbm9kZS5lbG0sIG5vZGVPcHMubmV4dFNpYmxpbmcob2xkRW5kVm5vZGUuZWxtKSk7CiAgICAgICAgb2xkU3RhcnRWbm9kZSA9IG9sZENoWysrb2xkU3RhcnRJZHhdOwogICAgICAgIG5ld0VuZFZub2RlID0gbmV3Q2hbLS1uZXdFbmRJZHhdOwogICAgICB9IGVsc2UgaWYgKHNhbWVWbm9kZShvbGRFbmRWbm9kZSwgbmV3U3RhcnRWbm9kZSkpIHsKICAgICAgICAvLyBWbm9kZSBtb3ZlZCBsZWZ0CiAgICAgICAgcGF0Y2hWbm9kZShvbGRFbmRWbm9kZSwgbmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgIGNhbk1vdmUgJiYgbm9kZU9wcy5pbnNlcnRCZWZvcmUocGFyZW50RWxtLCBvbGRFbmRWbm9kZS5lbG0sIG9sZFN0YXJ0Vm5vZGUuZWxtKTsKICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGlzVW5kZWYob2xkS2V5VG9JZHgpKSBvbGRLZXlUb0lkeCA9IGNyZWF0ZUtleVRvT2xkSWR4KG9sZENoLCBvbGRTdGFydElkeCwgb2xkRW5kSWR4KTsKICAgICAgICBpZHhJbk9sZCA9IGlzRGVmKG5ld1N0YXJ0Vm5vZGUua2V5KSA/IG9sZEtleVRvSWR4W25ld1N0YXJ0Vm5vZGUua2V5XSA6IGZpbmRJZHhJbk9sZChuZXdTdGFydFZub2RlLCBvbGRDaCwgb2xkU3RhcnRJZHgsIG9sZEVuZElkeCk7CgogICAgICAgIGlmIChpc1VuZGVmKGlkeEluT2xkKSkgewogICAgICAgICAgLy8gTmV3IGVsZW1lbnQKICAgICAgICAgIGNyZWF0ZUVsbShuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgb2xkU3RhcnRWbm9kZS5lbG0sIGZhbHNlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bm9kZVRvTW92ZSA9IG9sZENoW2lkeEluT2xkXTsKCiAgICAgICAgICBpZiAoc2FtZVZub2RlKHZub2RlVG9Nb3ZlLCBuZXdTdGFydFZub2RlKSkgewogICAgICAgICAgICBwYXRjaFZub2RlKHZub2RlVG9Nb3ZlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICAgIG9sZENoW2lkeEluT2xkXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgY2FuTW92ZSAmJiBub2RlT3BzLmluc2VydEJlZm9yZShwYXJlbnRFbG0sIHZub2RlVG9Nb3ZlLmVsbSwgb2xkU3RhcnRWbm9kZS5lbG0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gc2FtZSBrZXkgYnV0IGRpZmZlcmVudCBlbGVtZW50LiB0cmVhdCBhcyBuZXcgZWxlbWVudAogICAgICAgICAgICBjcmVhdGVFbG0obmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIG9sZFN0YXJ0Vm5vZGUuZWxtLCBmYWxzZSwgbmV3Q2gsIG5ld1N0YXJ0SWR4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFsrK25ld1N0YXJ0SWR4XTsKICAgICAgfQogICAgfQoKICAgIGlmIChvbGRTdGFydElkeCA+IG9sZEVuZElkeCkgewogICAgICByZWZFbG0gPSBpc1VuZGVmKG5ld0NoW25ld0VuZElkeCArIDFdKSA/IG51bGwgOiBuZXdDaFtuZXdFbmRJZHggKyAxXS5lbG07CiAgICAgIGFkZFZub2RlcyhwYXJlbnRFbG0sIHJlZkVsbSwgbmV3Q2gsIG5ld1N0YXJ0SWR4LCBuZXdFbmRJZHgsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICB9IGVsc2UgaWYgKG5ld1N0YXJ0SWR4ID4gbmV3RW5kSWR4KSB7CiAgICAgIHJlbW92ZVZub2RlcyhwYXJlbnRFbG0sIG9sZENoLCBvbGRTdGFydElkeCwgb2xkRW5kSWR4KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNoZWNrRHVwbGljYXRlS2V5cyhjaGlsZHJlbikgewogICAgdmFyIHNlZW5LZXlzID0ge307CgogICAgZm9yICh2YXIgX2k0ID0gMDsgX2k0IDwgY2hpbGRyZW4ubGVuZ3RoOyBfaTQrKykgewogICAgICB2YXIgdm5vZGUgPSBjaGlsZHJlbltfaTRdOwogICAgICB2YXIga2V5ID0gdm5vZGUua2V5OwoKICAgICAgaWYgKGlzRGVmKGtleSkpIHsKICAgICAgICBpZiAoc2VlbktleXNba2V5XSkgewogICAgICAgICAgd2FybigiRHVwbGljYXRlIGtleXMgZGV0ZWN0ZWQ6ICciLmNvbmNhdChrZXksICInLiBUaGlzIG1heSBjYXVzZSBhbiB1cGRhdGUgZXJyb3IuIiksIHZub2RlLmNvbnRleHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWVuS2V5c1trZXldID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpbmRJZHhJbk9sZChub2RlLCBvbGRDaCwgc3RhcnQsIGVuZCkgewogICAgZm9yICh2YXIgX2k1ID0gc3RhcnQ7IF9pNSA8IGVuZDsgX2k1KyspIHsKICAgICAgdmFyIGMgPSBvbGRDaFtfaTVdOwogICAgICBpZiAoaXNEZWYoYykgJiYgc2FtZVZub2RlKG5vZGUsIGMpKSByZXR1cm4gX2k1OwogICAgfQogIH0KCiAgZnVuY3Rpb24gcGF0Y2hWbm9kZShvbGRWbm9kZSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgb3duZXJBcnJheSwgaW5kZXgsIHJlbW92ZU9ubHkpIHsKICAgIGlmIChvbGRWbm9kZSA9PT0gdm5vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChpc0RlZih2bm9kZS5lbG0pICYmIGlzRGVmKG93bmVyQXJyYXkpKSB7CiAgICAgIC8vIGNsb25lIHJldXNlZCB2bm9kZQogICAgICB2bm9kZSA9IG93bmVyQXJyYXlbaW5kZXhdID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICB9CgogICAgdmFyIGVsbSA9IHZub2RlLmVsbSA9IG9sZFZub2RlLmVsbTsKCiAgICBpZiAoaXNUcnVlKG9sZFZub2RlLmlzQXN5bmNQbGFjZWhvbGRlcikpIHsKICAgICAgaWYgKGlzRGVmKHZub2RlLmFzeW5jRmFjdG9yeS5yZXNvbHZlZCkpIHsKICAgICAgICBoeWRyYXRlKG9sZFZub2RlLmVsbSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm5vZGUuaXNBc3luY1BsYWNlaG9sZGVyID0gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfSAvLyByZXVzZSBlbGVtZW50IGZvciBzdGF0aWMgdHJlZXMuCiAgICAvLyBub3RlIHdlIG9ubHkgZG8gdGhpcyBpZiB0aGUgdm5vZGUgaXMgY2xvbmVkIC0KICAgIC8vIGlmIHRoZSBuZXcgbm9kZSBpcyBub3QgY2xvbmVkIGl0IG1lYW5zIHRoZSByZW5kZXIgZnVuY3Rpb25zIGhhdmUgYmVlbgogICAgLy8gcmVzZXQgYnkgdGhlIGhvdC1yZWxvYWQtYXBpIGFuZCB3ZSBuZWVkIHRvIGRvIGEgcHJvcGVyIHJlLXJlbmRlci4KCgogICAgaWYgKGlzVHJ1ZSh2bm9kZS5pc1N0YXRpYykgJiYgaXNUcnVlKG9sZFZub2RlLmlzU3RhdGljKSAmJiB2bm9kZS5rZXkgPT09IG9sZFZub2RlLmtleSAmJiAoaXNUcnVlKHZub2RlLmlzQ2xvbmVkKSB8fCBpc1RydWUodm5vZGUuaXNPbmNlKSkpIHsKICAgICAgdm5vZGUuY29tcG9uZW50SW5zdGFuY2UgPSBvbGRWbm9kZS5jb21wb25lbnRJbnN0YW5jZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBpOwogICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwoKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5wcmVwYXRjaCkpIHsKICAgICAgaShvbGRWbm9kZSwgdm5vZGUpOwogICAgfQoKICAgIHZhciBvbGRDaCA9IG9sZFZub2RlLmNoaWxkcmVuOwogICAgdmFyIGNoID0gdm5vZGUuY2hpbGRyZW47CgogICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzUGF0Y2hhYmxlKHZub2RlKSkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgY2JzLnVwZGF0ZS5sZW5ndGg7ICsraSkgewogICAgICAgIGNicy51cGRhdGVbaV0ob2xkVm5vZGUsIHZub2RlKTsKICAgICAgfQoKICAgICAgaWYgKGlzRGVmKGkgPSBkYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLnVwZGF0ZSkpIGkob2xkVm5vZGUsIHZub2RlKTsKICAgIH0KCiAgICBpZiAoaXNVbmRlZih2bm9kZS50ZXh0KSkgewogICAgICBpZiAoaXNEZWYob2xkQ2gpICYmIGlzRGVmKGNoKSkgewogICAgICAgIGlmIChvbGRDaCAhPT0gY2gpIHVwZGF0ZUNoaWxkcmVuKGVsbSwgb2xkQ2gsIGNoLCBpbnNlcnRlZFZub2RlUXVldWUsIHJlbW92ZU9ubHkpOwogICAgICB9IGVsc2UgaWYgKGlzRGVmKGNoKSkgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMoY2gpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzRGVmKG9sZFZub2RlLnRleHQpKSBub2RlT3BzLnNldFRleHRDb250ZW50KGVsbSwgJycpOwogICAgICAgIGFkZFZub2RlcyhlbG0sIG51bGwsIGNoLCAwLCBjaC5sZW5ndGggLSAxLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICB9IGVsc2UgaWYgKGlzRGVmKG9sZENoKSkgewogICAgICAgIHJlbW92ZVZub2RlcyhlbG0sIG9sZENoLCAwLCBvbGRDaC5sZW5ndGggLSAxKTsKICAgICAgfSBlbHNlIGlmIChpc0RlZihvbGRWbm9kZS50ZXh0KSkgewogICAgICAgIG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCAnJyk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAob2xkVm5vZGUudGV4dCAhPT0gdm5vZGUudGV4dCkgewogICAgICBub2RlT3BzLnNldFRleHRDb250ZW50KGVsbSwgdm5vZGUudGV4dCk7CiAgICB9CgogICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgIGlmIChpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5wb3N0cGF0Y2gpKSBpKG9sZFZub2RlLCB2bm9kZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbnZva2VJbnNlcnRIb29rKHZub2RlLCBxdWV1ZSwgaW5pdGlhbCkgewogICAgLy8gZGVsYXkgaW5zZXJ0IGhvb2tzIGZvciBjb21wb25lbnQgcm9vdCBub2RlcywgaW52b2tlIHRoZW0gYWZ0ZXIgdGhlCiAgICAvLyBlbGVtZW50IGlzIHJlYWxseSBpbnNlcnRlZAogICAgaWYgKGlzVHJ1ZShpbml0aWFsKSAmJiBpc0RlZih2bm9kZS5wYXJlbnQpKSB7CiAgICAgIHZub2RlLnBhcmVudC5kYXRhLnBlbmRpbmdJbnNlcnQgPSBxdWV1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAodmFyIF9pNiA9IDA7IF9pNiA8IHF1ZXVlLmxlbmd0aDsgKytfaTYpIHsKICAgICAgICBxdWV1ZVtfaTZdLmRhdGEuaG9vay5pbnNlcnQocXVldWVbX2k2XSk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBoeWRyYXRpb25CYWlsZWQgPSBmYWxzZTsgLy8gbGlzdCBvZiBtb2R1bGVzIHRoYXQgY2FuIHNraXAgY3JlYXRlIGhvb2sgZHVyaW5nIGh5ZHJhdGlvbiBiZWNhdXNlIHRoZXkKICAvLyBhcmUgYWxyZWFkeSByZW5kZXJlZCBvbiB0aGUgY2xpZW50IG9yIGhhcyBubyBuZWVkIGZvciBpbml0aWFsaXphdGlvbgogIC8vIE5vdGU6IHN0eWxlIGlzIGV4Y2x1ZGVkIGJlY2F1c2UgaXQgcmVsaWVzIG9uIGluaXRpYWwgY2xvbmUgZm9yIGZ1dHVyZQogIC8vIGRlZXAgdXBkYXRlcyAoIzcwNjMpLgoKICB2YXIgaXNSZW5kZXJlZE1vZHVsZSA9IG1ha2VNYXAoJ2F0dHJzLGNsYXNzLHN0YXRpY0NsYXNzLHN0YXRpY1N0eWxlLGtleScpOyAvLyBOb3RlOiB0aGlzIGlzIGEgYnJvd3Nlci1vbmx5IGZ1bmN0aW9uIHNvIHdlIGNhbiBhc3N1bWUgZWxtcyBhcmUgRE9NIG5vZGVzLgoKICBmdW5jdGlvbiBoeWRyYXRlKGVsbSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgaW5WUHJlKSB7CiAgICB2YXIgaTsKICAgIHZhciB0YWcgPSB2bm9kZS50YWcsCiAgICAgICAgZGF0YSA9IHZub2RlLmRhdGEsCiAgICAgICAgY2hpbGRyZW4gPSB2bm9kZS5jaGlsZHJlbjsKICAgIGluVlByZSA9IGluVlByZSB8fCBkYXRhICYmIGRhdGEucHJlOwogICAgdm5vZGUuZWxtID0gZWxtOwoKICAgIGlmIChpc1RydWUodm5vZGUuaXNDb21tZW50KSAmJiBpc0RlZih2bm9kZS5hc3luY0ZhY3RvcnkpKSB7CiAgICAgIHZub2RlLmlzQXN5bmNQbGFjZWhvbGRlciA9IHRydWU7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBhc3NlcnQgbm9kZSBtYXRjaAoKCiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBpZiAoIWFzc2VydE5vZGVNYXRjaChlbG0sIHZub2RlLCBpblZQcmUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgIGlmIChpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5pbml0KSkgaSh2bm9kZSwgdHJ1ZQogICAgICAvKiBoeWRyYXRpbmcgKi8KICAgICAgKTsKCiAgICAgIGlmIChpc0RlZihpID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UpKSB7CiAgICAgICAgLy8gY2hpbGQgY29tcG9uZW50LiBpdCBzaG91bGQgaGF2ZSBoeWRyYXRlZCBpdHMgb3duIHRyZWUuCiAgICAgICAgaW5pdENvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGlmIChpc0RlZih0YWcpKSB7CiAgICAgIGlmIChpc0RlZihjaGlsZHJlbikpIHsKICAgICAgICAvLyBlbXB0eSBlbGVtZW50LCBhbGxvdyBjbGllbnQgdG8gcGljayB1cCBhbmQgcG9wdWxhdGUgY2hpbGRyZW4KICAgICAgICBpZiAoIWVsbS5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgICAgIGNyZWF0ZUNoaWxkcmVuKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gdi1odG1sIGFuZCBkb21Qcm9wczogaW5uZXJIVE1MCiAgICAgICAgICBpZiAoaXNEZWYoaSA9IGRhdGEpICYmIGlzRGVmKGkgPSBpLmRvbVByb3BzKSAmJiBpc0RlZihpID0gaS5pbm5lckhUTUwpKSB7CiAgICAgICAgICAgIGlmIChpICE9PSBlbG0uaW5uZXJIVE1MKSB7CiAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmICFoeWRyYXRpb25CYWlsZWQpIHsKICAgICAgICAgICAgICAgIGh5ZHJhdGlvbkJhaWxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1BhcmVudDogJywgZWxtKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybignc2VydmVyIGlubmVySFRNTDogJywgaSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ2NsaWVudCBpbm5lckhUTUw6ICcsIGVsbS5pbm5lckhUTUwpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpdGVyYXRlIGFuZCBjb21wYXJlIGNoaWxkcmVuIGxpc3RzCiAgICAgICAgICAgIHZhciBjaGlsZHJlbk1hdGNoID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIGNoaWxkTm9kZSA9IGVsbS5maXJzdENoaWxkOwoKICAgICAgICAgICAgZm9yICh2YXIgX2k3ID0gMDsgX2k3IDwgY2hpbGRyZW4ubGVuZ3RoOyBfaTcrKykgewogICAgICAgICAgICAgIGlmICghY2hpbGROb2RlIHx8ICFoeWRyYXRlKGNoaWxkTm9kZSwgY2hpbGRyZW5bX2k3XSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBpblZQcmUpKSB7CiAgICAgICAgICAgICAgICBjaGlsZHJlbk1hdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNoaWxkTm9kZSA9IGNoaWxkTm9kZS5uZXh0U2libGluZzsKICAgICAgICAgICAgfSAvLyBpZiBjaGlsZE5vZGUgaXMgbm90IG51bGwsIGl0IG1lYW5zIHRoZSBhY3R1YWwgY2hpbGROb2RlcyBsaXN0IGlzCiAgICAgICAgICAgIC8vIGxvbmdlciB0aGFuIHRoZSB2aXJ0dWFsIGNoaWxkcmVuIGxpc3QuCgoKICAgICAgICAgICAgaWYgKCFjaGlsZHJlbk1hdGNoIHx8IGNoaWxkTm9kZSkgewogICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiAhaHlkcmF0aW9uQmFpbGVkKSB7CiAgICAgICAgICAgICAgICBoeWRyYXRpb25CYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdQYXJlbnQ6ICcsIGVsbSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ01pc21hdGNoaW5nIGNoaWxkTm9kZXMgdnMuIFZOb2RlczogJywgZWxtLmNoaWxkTm9kZXMsIGNoaWxkcmVuKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgdmFyIGZ1bGxJbnZva2UgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHsKICAgICAgICAgIGlmICghaXNSZW5kZXJlZE1vZHVsZShrZXkpKSB7CiAgICAgICAgICAgIGZ1bGxJbnZva2UgPSB0cnVlOwogICAgICAgICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIWZ1bGxJbnZva2UgJiYgZGF0YVsnY2xhc3MnXSkgewogICAgICAgICAgLy8gZW5zdXJlIGNvbGxlY3RpbmcgZGVwcyBmb3IgZGVlcCBjbGFzcyBiaW5kaW5ncyBmb3IgZnV0dXJlIHVwZGF0ZXMKICAgICAgICAgIHRyYXZlcnNlKGRhdGFbJ2NsYXNzJ10pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChlbG0uZGF0YSAhPT0gdm5vZGUudGV4dCkgewogICAgICBlbG0uZGF0YSA9IHZub2RlLnRleHQ7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnROb2RlTWF0Y2gobm9kZSwgdm5vZGUsIGluVlByZSkgewogICAgaWYgKGlzRGVmKHZub2RlLnRhZykpIHsKICAgICAgcmV0dXJuIHZub2RlLnRhZy5pbmRleE9mKCd2dWUtY29tcG9uZW50JykgPT09IDAgfHwgIWlzVW5rbm93bkVsZW1lbnQodm5vZGUsIGluVlByZSkgJiYgdm5vZGUudGFnLnRvTG93ZXJDYXNlKCkgPT09IChub2RlLnRhZ05hbWUgJiYgbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT09ICh2bm9kZS5pc0NvbW1lbnQgPyA4IDogMyk7CiAgICB9CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gcGF0Y2gob2xkVm5vZGUsIHZub2RlLCBoeWRyYXRpbmcsIHJlbW92ZU9ubHkpIHsKICAgIGlmIChpc1VuZGVmKHZub2RlKSkgewogICAgICBpZiAoaXNEZWYob2xkVm5vZGUpKSBpbnZva2VEZXN0cm95SG9vayhvbGRWbm9kZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaXNJbml0aWFsUGF0Y2ggPSBmYWxzZTsKICAgIHZhciBpbnNlcnRlZFZub2RlUXVldWUgPSBbXTsKCiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZSkpIHsKICAgICAgLy8gZW1wdHkgbW91bnQgKGxpa2VseSBhcyBjb21wb25lbnQpLCBjcmVhdGUgbmV3IHJvb3QgZWxlbWVudAogICAgICBpc0luaXRpYWxQYXRjaCA9IHRydWU7CiAgICAgIGNyZWF0ZUVsbSh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBpc1JlYWxFbGVtZW50ID0gaXNEZWYob2xkVm5vZGUubm9kZVR5cGUpOwoKICAgICAgaWYgKCFpc1JlYWxFbGVtZW50ICYmIHNhbWVWbm9kZShvbGRWbm9kZSwgdm5vZGUpKSB7CiAgICAgICAgLy8gcGF0Y2ggZXhpc3Rpbmcgcm9vdCBub2RlCiAgICAgICAgcGF0Y2hWbm9kZShvbGRWbm9kZSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbnVsbCwgbnVsbCwgcmVtb3ZlT25seSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGlzUmVhbEVsZW1lbnQpIHsKICAgICAgICAgIC8vIG1vdW50aW5nIHRvIGEgcmVhbCBlbGVtZW50CiAgICAgICAgICAvLyBjaGVjayBpZiB0aGlzIGlzIHNlcnZlci1yZW5kZXJlZCBjb250ZW50IGFuZCBpZiB3ZSBjYW4gcGVyZm9ybQogICAgICAgICAgLy8gYSBzdWNjZXNzZnVsIGh5ZHJhdGlvbi4KICAgICAgICAgIGlmIChvbGRWbm9kZS5ub2RlVHlwZSA9PT0gMSAmJiBvbGRWbm9kZS5oYXNBdHRyaWJ1dGUoU1NSX0FUVFIpKSB7CiAgICAgICAgICAgIG9sZFZub2RlLnJlbW92ZUF0dHJpYnV0ZShTU1JfQVRUUik7CiAgICAgICAgICAgIGh5ZHJhdGluZyA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGlzVHJ1ZShoeWRyYXRpbmcpKSB7CiAgICAgICAgICAgIGlmIChoeWRyYXRlKG9sZFZub2RlLCB2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSkgewogICAgICAgICAgICAgIGludm9rZUluc2VydEhvb2sodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgcmV0dXJuIG9sZFZub2RlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICB3YXJuKCdUaGUgY2xpZW50LXNpZGUgcmVuZGVyZWQgdmlydHVhbCBET00gdHJlZSBpcyBub3QgbWF0Y2hpbmcgJyArICdzZXJ2ZXItcmVuZGVyZWQgY29udGVudC4gVGhpcyBpcyBsaWtlbHkgY2F1c2VkIGJ5IGluY29ycmVjdCAnICsgJ0hUTUwgbWFya3VwLCBmb3IgZXhhbXBsZSBuZXN0aW5nIGJsb2NrLWxldmVsIGVsZW1lbnRzIGluc2lkZSAnICsgJzxwPiwgb3IgbWlzc2luZyA8dGJvZHk+LiBCYWlsaW5nIGh5ZHJhdGlvbiBhbmQgcGVyZm9ybWluZyAnICsgJ2Z1bGwgY2xpZW50LXNpZGUgcmVuZGVyLicpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIGVpdGhlciBub3Qgc2VydmVyLXJlbmRlcmVkLCBvciBoeWRyYXRpb24gZmFpbGVkLgogICAgICAgICAgLy8gY3JlYXRlIGFuIGVtcHR5IG5vZGUgYW5kIHJlcGxhY2UgaXQKCgogICAgICAgICAgb2xkVm5vZGUgPSBlbXB0eU5vZGVBdChvbGRWbm9kZSk7CiAgICAgICAgfSAvLyByZXBsYWNpbmcgZXhpc3RpbmcgZWxlbWVudAoKCiAgICAgICAgdmFyIG9sZEVsbSA9IG9sZFZub2RlLmVsbTsKICAgICAgICB2YXIgcGFyZW50RWxtID0gbm9kZU9wcy5wYXJlbnROb2RlKG9sZEVsbSk7IC8vIGNyZWF0ZSBuZXcgbm9kZQoKICAgICAgICBjcmVhdGVFbG0odm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgLy8gZXh0cmVtZWx5IHJhcmUgZWRnZSBjYXNlOiBkbyBub3QgaW5zZXJ0IGlmIG9sZCBlbGVtZW50IGlzIGluIGEKICAgICAgICAvLyBsZWF2aW5nIHRyYW5zaXRpb24uIE9ubHkgaGFwcGVucyB3aGVuIGNvbWJpbmluZyB0cmFuc2l0aW9uICsKICAgICAgICAvLyBrZWVwLWFsaXZlICsgSE9Dcy4gKCM0NTkwKQogICAgICAgIG9sZEVsbS5fbGVhdmVDYiA/IG51bGwgOiBwYXJlbnRFbG0sIG5vZGVPcHMubmV4dFNpYmxpbmcob2xkRWxtKSk7IC8vIHVwZGF0ZSBwYXJlbnQgcGxhY2Vob2xkZXIgbm9kZSBlbGVtZW50LCByZWN1cnNpdmVseQoKICAgICAgICBpZiAoaXNEZWYodm5vZGUucGFyZW50KSkgewogICAgICAgICAgdmFyIGFuY2VzdG9yID0gdm5vZGUucGFyZW50OwogICAgICAgICAgdmFyIHBhdGNoYWJsZSA9IGlzUGF0Y2hhYmxlKHZub2RlKTsKCiAgICAgICAgICB3aGlsZSAoYW5jZXN0b3IpIHsKICAgICAgICAgICAgZm9yICh2YXIgX2k4ID0gMDsgX2k4IDwgY2JzLmRlc3Ryb3kubGVuZ3RoOyArK19pOCkgewogICAgICAgICAgICAgIGNicy5kZXN0cm95W19pOF0oYW5jZXN0b3IpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhbmNlc3Rvci5lbG0gPSB2bm9kZS5lbG07CgogICAgICAgICAgICBpZiAocGF0Y2hhYmxlKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2k5ID0gMDsgX2k5IDwgY2JzLmNyZWF0ZS5sZW5ndGg7ICsrX2k5KSB7CiAgICAgICAgICAgICAgICBjYnMuY3JlYXRlW19pOV0oZW1wdHlOb2RlLCBhbmNlc3Rvcik7CiAgICAgICAgICAgICAgfSAvLyAjNjUxMwogICAgICAgICAgICAgIC8vIGludm9rZSBpbnNlcnQgaG9va3MgdGhhdCBtYXkgaGF2ZSBiZWVuIG1lcmdlZCBieSBjcmVhdGUgaG9va3MuCiAgICAgICAgICAgICAgLy8gZS5nLiBmb3IgZGlyZWN0aXZlcyB0aGF0IHVzZXMgdGhlICJpbnNlcnRlZCIgaG9vay4KCgogICAgICAgICAgICAgIHZhciBfaW5zZXJ0ID0gYW5jZXN0b3IuZGF0YS5ob29rLmluc2VydDsKCiAgICAgICAgICAgICAgaWYgKF9pbnNlcnQubWVyZ2VkKSB7CiAgICAgICAgICAgICAgICAvLyBzdGFydCBhdCBpbmRleCAxIHRvIGF2b2lkIHJlLWludm9raW5nIGNvbXBvbmVudCBtb3VudGVkIGhvb2sKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pMTAgPSAxOyBfaTEwIDwgX2luc2VydC5mbnMubGVuZ3RoOyBfaTEwKyspIHsKICAgICAgICAgICAgICAgICAgX2luc2VydC5mbnNbX2kxMF0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVnaXN0ZXJSZWYoYW5jZXN0b3IpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhbmNlc3RvciA9IGFuY2VzdG9yLnBhcmVudDsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGRlc3Ryb3kgb2xkIG5vZGUKCgogICAgICAgIGlmIChpc0RlZihwYXJlbnRFbG0pKSB7CiAgICAgICAgICByZW1vdmVWbm9kZXMocGFyZW50RWxtLCBbb2xkVm5vZGVdLCAwLCAwKTsKICAgICAgICB9IGVsc2UgaWYgKGlzRGVmKG9sZFZub2RlLnRhZykpIHsKICAgICAgICAgIGludm9rZURlc3Ryb3lIb29rKG9sZFZub2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpbnZva2VJbnNlcnRIb29rKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIGlzSW5pdGlhbFBhdGNoKTsKICAgIHJldHVybiB2bm9kZS5lbG07CiAgfTsKfQ=="},{"version":3,"sources":["/Users/tech/workspace/demo/vue-demo/src/vueResource/core/vdom/patch.js"],"names":["VNode","cloneVNode","config","SSR_ATTR","registerRef","traverse","activeInstance","isTextInputType","warn","isDef","isUndef","isTrue","makeMap","isRegExp","isPrimitive","emptyNode","hooks","sameVnode","a","b","key","tag","isComment","data","sameInputType","isAsyncPlaceholder","asyncFactory","error","i","typeA","attrs","type","typeB","createKeyToOldIdx","children","beginIdx","endIdx","map","createPatchFunction","backend","j","cbs","modules","nodeOps","length","push","emptyNodeAt","elm","tagName","toLowerCase","undefined","createRmCb","childElm","listeners","remove","removeNode","el","parent","parentNode","removeChild","isUnknownElement","vnode","inVPre","ns","ignoredElements","some","ignore","test","creatingElmInVPre","createElm","insertedVnodeQueue","parentElm","refElm","nested","ownerArray","index","isRootInsert","createComponent","process","env","NODE_ENV","pre","context","createElementNS","createElement","setScope","window","__WEEX__","appendAsTree","invokeCreateHooks","insert","createChildren","createComment","text","createTextNode","isReactivated","componentInstance","keepAlive","hook","init","initComponent","reactivateComponent","pendingInsert","apply","$el","isPatchable","innerNode","_vnode","transition","activate","ref","insertBefore","appendChild","Array","isArray","checkDuplicateKeys","String","create","fnScopeId","setStyleScope","ancestor","$options","_scopeId","fnContext","addVnodes","vnodes","startIdx","invokeDestroyHook","destroy","removeVnodes","ch","removeAndInvokeRemoveHook","rm","updateChildren","oldCh","newCh","removeOnly","oldStartIdx","newStartIdx","oldEndIdx","oldStartVnode","oldEndVnode","newEndIdx","newStartVnode","newEndVnode","oldKeyToIdx","idxInOld","vnodeToMove","canMove","patchVnode","nextSibling","findIdxInOld","seenKeys","node","start","end","c","oldVnode","resolved","hydrate","isStatic","isCloned","isOnce","prepatch","update","setTextContent","postpatch","invokeInsertHook","queue","initial","hydrationBailed","isRenderedModule","assertNodeMatch","hasChildNodes","domProps","innerHTML","console","childrenMatch","childNode","firstChild","childNodes","fullInvoke","indexOf","nodeType","patch","hydrating","isInitialPatch","isRealElement","hasAttribute","removeAttribute","oldElm","_leaveCb","patchable","merged","fns"],"mappings":"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","sourcesContent":["/**\n * Virtual DOM patching algorithm based on Snabbdom by\n * Simon Friis Vindum (@paldepind)\n * Licensed under the MIT License\n * https://github.com/paldepind/snabbdom/blob/master/LICENSE\n *\n * modified by Evan You (@yyx990803)\n *\n * Not type-checking this because this file is perf-critical and the cost\n * of making flow understand it is not worth it.\n */\n\nimport VNode, {cloneVNode} from './vnode'\nimport config from '../config'\nimport {SSR_ATTR} from '../../shared/constants'\nimport {registerRef} from './modules/ref'\nimport {traverse} from '../observer/traverse'\nimport {activeInstance} from '../instance/lifecycle'\nimport {isTextInputType} from '../../platforms/web/util/element'\n\nimport {\n  warn,\n  isDef,\n  isUndef,\n  isTrue,\n  makeMap,\n  isRegExp,\n  isPrimitive\n} from '../util/index'\n\nexport const emptyNode = new VNode('', {}, [])\n\nconst hooks = ['create', 'activate', 'update', 'remove', 'destroy']\n\nfunction sameVnode(a, b) {\n  return (\n    a.key === b.key && (\n      (\n        a.tag === b.tag &&\n        a.isComment === b.isComment &&\n        isDef(a.data) === isDef(b.data) &&\n        sameInputType(a, b)\n      ) || (\n        isTrue(a.isAsyncPlaceholder) &&\n        a.asyncFactory === b.asyncFactory &&\n        isUndef(b.asyncFactory.error)\n      )\n    )\n  )\n}\n\nfunction sameInputType(a, b) {\n  if (a.tag !== 'input') return true\n  let i\n  const typeA = isDef(i = a.data) && isDef(i = i.attrs) && i.type\n  const typeB = isDef(i = b.data) && isDef(i = i.attrs) && i.type\n  return typeA === typeB || isTextInputType(typeA) && isTextInputType(typeB)\n}\n\nfunction createKeyToOldIdx(children, beginIdx, endIdx) {\n  let i, key\n  const map = {}\n  for (i = beginIdx; i <= endIdx; ++i) {\n    key = children[i].key\n    if (isDef(key)) map[key] = i\n  }\n  return map\n}\n\nexport function createPatchFunction(backend) {\n  let i, j\n  const cbs = {}\n\n  const {modules, nodeOps} = backend\n\n  for (i = 0; i < hooks.length; ++i) {\n    cbs[hooks[i]] = []\n    for (j = 0; j < modules.length; ++j) {\n      if (isDef(modules[j][hooks[i]])) {\n        cbs[hooks[i]].push(modules[j][hooks[i]])\n      }\n    }\n  }\n\n  function emptyNodeAt(elm) {\n    return new VNode(nodeOps.tagName(elm).toLowerCase(), {}, [], undefined, elm)\n  }\n\n  function createRmCb(childElm, listeners) {\n    function remove() {\n      if (--remove.listeners === 0) {\n        removeNode(childElm)\n      }\n    }\n\n    remove.listeners = listeners\n    return remove\n  }\n\n  function removeNode(el) {\n    const parent = nodeOps.parentNode(el)\n    // element may have already been removed due to v-html / v-text\n    if (isDef(parent)) {\n      nodeOps.removeChild(parent, el)\n    }\n  }\n\n  function isUnknownElement(vnode, inVPre) {\n    return (\n      !inVPre &&\n      !vnode.ns &&\n      !(\n        config.ignoredElements.length &&\n        config.ignoredElements.some(ignore => {\n          return isRegExp(ignore)\n            ? ignore.test(vnode.tag)\n            : ignore === vnode.tag\n        })\n      ) &&\n      config.isUnknownElement(vnode.tag)\n    )\n  }\n\n  let creatingElmInVPre = 0\n\n  function createElm(\n    vnode,\n    insertedVnodeQueue,\n    parentElm,\n    refElm,\n    nested,\n    ownerArray,\n    index\n  ) {\n    if (isDef(vnode.elm) && isDef(ownerArray)) {\n      // This vnode was used in a previous render!\n      // now it's used as a new node, overwriting its elm would cause\n      // potential patch errors down the road when it's used as an insertion\n      // reference node. Instead, we clone the node on-demand before creating\n      // associated DOM element for it.\n      vnode = ownerArray[index] = cloneVNode(vnode)\n    }\n\n    vnode.isRootInsert = !nested // for transition enter check\n    if (createComponent(vnode, insertedVnodeQueue, parentElm, refElm)) {\n      return\n    }\n\n    const data = vnode.data\n    const children = vnode.children\n    const tag = vnode.tag\n    if (isDef(tag)) {\n      if (process.env.NODE_ENV !== 'production') {\n        if (data && data.pre) {\n          creatingElmInVPre++\n        }\n        if (isUnknownElement(vnode, creatingElmInVPre)) {\n          warn(\n            'Unknown custom element: <' + tag + '> - did you ' +\n            'register the component correctly? For recursive components, ' +\n            'make sure to provide the \"name\" option.',\n            vnode.context\n          )\n        }\n      }\n\n      vnode.elm = vnode.ns\n        ? nodeOps.createElementNS(vnode.ns, tag)\n        : nodeOps.createElement(tag, vnode)\n      setScope(vnode)\n\n      /* istanbul ignore if */\n      if (window.__WEEX__) {\n        // in Weex, the default insertion order is parent-first.\n        // List items can be optimized to use children-first insertion\n        // with append=\"tree\".\n        const appendAsTree = isDef(data) && isTrue(data.appendAsTree)\n        if (!appendAsTree) {\n          if (isDef(data)) {\n            invokeCreateHooks(vnode, insertedVnodeQueue)\n          }\n          insert(parentElm, vnode.elm, refElm)\n        }\n        createChildren(vnode, children, insertedVnodeQueue)\n        if (appendAsTree) {\n          if (isDef(data)) {\n            invokeCreateHooks(vnode, insertedVnodeQueue)\n          }\n          insert(parentElm, vnode.elm, refElm)\n        }\n      } else {\n        createChildren(vnode, children, insertedVnodeQueue)\n        if (isDef(data)) {\n          invokeCreateHooks(vnode, insertedVnodeQueue)\n        }\n        insert(parentElm, vnode.elm, refElm)\n      }\n\n      if (process.env.NODE_ENV !== 'production' && data && data.pre) {\n        creatingElmInVPre--\n      }\n    } else if (isTrue(vnode.isComment)) {\n      vnode.elm = nodeOps.createComment(vnode.text)\n      insert(parentElm, vnode.elm, refElm)\n    } else {\n      vnode.elm = nodeOps.createTextNode(vnode.text)\n      insert(parentElm, vnode.elm, refElm)\n    }\n  }\n\n  function createComponent(vnode, insertedVnodeQueue, parentElm, refElm) {\n    let i = vnode.data\n    if (isDef(i)) {\n      const isReactivated = isDef(vnode.componentInstance) && i.keepAlive\n      if (isDef(i = i.hook) && isDef(i = i.init)) {\n        i(vnode, false /* hydrating */)\n      }\n      // after calling the init hook, if the vnode is a child component\n      // it should've created a child instance and mounted it. the child\n      // component also has set the placeholder vnode's elm.\n      // in that case we can just return the element and be done.\n      if (isDef(vnode.componentInstance)) {\n        initComponent(vnode, insertedVnodeQueue)\n        insert(parentElm, vnode.elm, refElm)\n        if (isTrue(isReactivated)) {\n          reactivateComponent(vnode, insertedVnodeQueue, parentElm, refElm)\n        }\n        return true\n      }\n    }\n  }\n\n  function initComponent(vnode, insertedVnodeQueue) {\n    if (isDef(vnode.data.pendingInsert)) {\n      insertedVnodeQueue.push.apply(insertedVnodeQueue, vnode.data.pendingInsert)\n      vnode.data.pendingInsert = null\n    }\n    vnode.elm = vnode.componentInstance.$el\n    if (isPatchable(vnode)) {\n      invokeCreateHooks(vnode, insertedVnodeQueue)\n      setScope(vnode)\n    } else {\n      // empty component root.\n      // skip all element-related modules except for ref (#3455)\n      registerRef(vnode)\n      // make sure to invoke the insert hook\n      insertedVnodeQueue.push(vnode)\n    }\n  }\n\n  function reactivateComponent(vnode, insertedVnodeQueue, parentElm, refElm) {\n    let i\n    // hack for #4339: a reactivated component with inner transition\n    // does not trigger because the inner node's created hooks are not called\n    // again. It's not ideal to involve module-specific logic in here but\n    // there doesn't seem to be a better way to do it.\n    let innerNode = vnode\n    while (innerNode.componentInstance) {\n      innerNode = innerNode.componentInstance._vnode\n      if (isDef(i = innerNode.data) && isDef(i = i.transition)) {\n        for (i = 0; i < cbs.activate.length; ++i) {\n          cbs.activate[i](emptyNode, innerNode)\n        }\n        insertedVnodeQueue.push(innerNode)\n        break\n      }\n    }\n    // unlike a newly created component,\n    // a reactivated keep-alive component doesn't insert itself\n    insert(parentElm, vnode.elm, refElm)\n  }\n\n  function insert(parent, elm, ref) {\n    if (isDef(parent)) {\n      if (isDef(ref)) {\n        if (nodeOps.parentNode(ref) === parent) {\n          nodeOps.insertBefore(parent, elm, ref)\n        }\n      } else {\n        nodeOps.appendChild(parent, elm)\n      }\n    }\n  }\n\n  function createChildren(vnode, children, insertedVnodeQueue) {\n    if (Array.isArray(children)) {\n      if (process.env.NODE_ENV !== 'production') {\n        checkDuplicateKeys(children)\n      }\n      for (let i = 0; i < children.length; ++i) {\n        createElm(children[i], insertedVnodeQueue, vnode.elm, null, true, children, i)\n      }\n    } else if (isPrimitive(vnode.text)) {\n      nodeOps.appendChild(vnode.elm, nodeOps.createTextNode(String(vnode.text)))\n    }\n  }\n\n  function isPatchable(vnode) {\n    while (vnode.componentInstance) {\n      vnode = vnode.componentInstance._vnode\n    }\n    return isDef(vnode.tag)\n  }\n\n  function invokeCreateHooks(vnode, insertedVnodeQueue) {\n    for (let i = 0; i < cbs.create.length; ++i) {\n      cbs.create[i](emptyNode, vnode)\n    }\n    i = vnode.data.hook // Reuse variable\n    if (isDef(i)) {\n      if (isDef(i.create)) i.create(emptyNode, vnode)\n      if (isDef(i.insert)) insertedVnodeQueue.push(vnode)\n    }\n  }\n\n  // set scope id attribute for scoped CSS.\n  // this is implemented as a special case to avoid the overhead\n  // of going through the normal attribute patching process.\n  function setScope(vnode) {\n    let i\n    if (isDef(i = vnode.fnScopeId)) {\n      nodeOps.setStyleScope(vnode.elm, i)\n    } else {\n      let ancestor = vnode\n      while (ancestor) {\n        if (isDef(i = ancestor.context) && isDef(i = i.$options._scopeId)) {\n          nodeOps.setStyleScope(vnode.elm, i)\n        }\n        ancestor = ancestor.parent\n      }\n    }\n    // for slot content they should also get the scopeId from the host instance.\n    if (isDef(i = activeInstance) &&\n      i !== vnode.context &&\n      i !== vnode.fnContext &&\n      isDef(i = i.$options._scopeId)\n    ) {\n      nodeOps.setStyleScope(vnode.elm, i)\n    }\n  }\n\n  function addVnodes(parentElm, refElm, vnodes, startIdx, endIdx, insertedVnodeQueue) {\n    for (; startIdx <= endIdx; ++startIdx) {\n      createElm(vnodes[startIdx], insertedVnodeQueue, parentElm, refElm, false, vnodes, startIdx)\n    }\n  }\n\n  function invokeDestroyHook(vnode) {\n    let i, j\n    const data = vnode.data\n    if (isDef(data)) {\n      if (isDef(i = data.hook) && isDef(i = i.destroy)) i(vnode)\n      for (i = 0; i < cbs.destroy.length; ++i) cbs.destroy[i](vnode)\n    }\n    if (isDef(i = vnode.children)) {\n      for (j = 0; j < vnode.children.length; ++j) {\n        invokeDestroyHook(vnode.children[j])\n      }\n    }\n  }\n\n  function removeVnodes(parentElm, vnodes, startIdx, endIdx) {\n    for (; startIdx <= endIdx; ++startIdx) {\n      const ch = vnodes[startIdx]\n      if (isDef(ch)) {\n        if (isDef(ch.tag)) {\n          removeAndInvokeRemoveHook(ch)\n          invokeDestroyHook(ch)\n        } else { // Text node\n          removeNode(ch.elm)\n        }\n      }\n    }\n  }\n\n  function removeAndInvokeRemoveHook(vnode, rm) {\n    if (isDef(rm) || isDef(vnode.data)) {\n      let i\n      const listeners = cbs.remove.length + 1\n      if (isDef(rm)) {\n        // we have a recursively passed down rm callback\n        // increase the listeners count\n        rm.listeners += listeners\n      } else {\n        // directly removing\n        rm = createRmCb(vnode.elm, listeners)\n      }\n      // recursively invoke hooks on child component root node\n      if (isDef(i = vnode.componentInstance) && isDef(i = i._vnode) && isDef(i.data)) {\n        removeAndInvokeRemoveHook(i, rm)\n      }\n      for (i = 0; i < cbs.remove.length; ++i) {\n        cbs.remove[i](vnode, rm)\n      }\n      if (isDef(i = vnode.data.hook) && isDef(i = i.remove)) {\n        i(vnode, rm)\n      } else {\n        rm()\n      }\n    } else {\n      removeNode(vnode.elm)\n    }\n  }\n\n  function updateChildren(parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) {\n    let oldStartIdx = 0\n    let newStartIdx = 0\n    let oldEndIdx = oldCh.length - 1\n    let oldStartVnode = oldCh[0]\n    let oldEndVnode = oldCh[oldEndIdx]\n    let newEndIdx = newCh.length - 1\n    let newStartVnode = newCh[0]\n    let newEndVnode = newCh[newEndIdx]\n    let oldKeyToIdx, idxInOld, vnodeToMove, refElm\n\n    // removeOnly is a special flag used only by <transition-group>\n    // to ensure removed elements stay in correct relative positions\n    // during leaving transitions\n    const canMove = !removeOnly\n\n    if (process.env.NODE_ENV !== 'production') {\n      checkDuplicateKeys(newCh)\n    }\n\n    while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n      if (isUndef(oldStartVnode)) {\n        oldStartVnode = oldCh[++oldStartIdx] // Vnode has been moved left\n      } else if (isUndef(oldEndVnode)) {\n        oldEndVnode = oldCh[--oldEndIdx]\n      } else if (sameVnode(oldStartVnode, newStartVnode)) {\n        patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)\n        oldStartVnode = oldCh[++oldStartIdx]\n        newStartVnode = newCh[++newStartIdx]\n      } else if (sameVnode(oldEndVnode, newEndVnode)) {\n        patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)\n        oldEndVnode = oldCh[--oldEndIdx]\n        newEndVnode = newCh[--newEndIdx]\n      } else if (sameVnode(oldStartVnode, newEndVnode)) { // Vnode moved right\n        patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)\n        canMove && nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))\n        oldStartVnode = oldCh[++oldStartIdx]\n        newEndVnode = newCh[--newEndIdx]\n      } else if (sameVnode(oldEndVnode, newStartVnode)) { // Vnode moved left\n        patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)\n        canMove && nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)\n        oldEndVnode = oldCh[--oldEndIdx]\n        newStartVnode = newCh[++newStartIdx]\n      } else {\n        if (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)\n        idxInOld = isDef(newStartVnode.key)\n          ? oldKeyToIdx[newStartVnode.key]\n          : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)\n        if (isUndef(idxInOld)) { // New element\n          createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)\n        } else {\n          vnodeToMove = oldCh[idxInOld]\n          if (sameVnode(vnodeToMove, newStartVnode)) {\n            patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)\n            oldCh[idxInOld] = undefined\n            canMove && nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)\n          } else {\n            // same key but different element. treat as new element\n            createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)\n          }\n        }\n        newStartVnode = newCh[++newStartIdx]\n      }\n    }\n    if (oldStartIdx > oldEndIdx) {\n      refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm\n      addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)\n    } else if (newStartIdx > newEndIdx) {\n      removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)\n    }\n  }\n\n  function checkDuplicateKeys(children) {\n    const seenKeys = {}\n    for (let i = 0; i < children.length; i++) {\n      const vnode = children[i]\n      const key = vnode.key\n      if (isDef(key)) {\n        if (seenKeys[key]) {\n          warn(\n            `Duplicate keys detected: '${key}'. This may cause an update error.`,\n            vnode.context\n          )\n        } else {\n          seenKeys[key] = true\n        }\n      }\n    }\n  }\n\n  function findIdxInOld(node, oldCh, start, end) {\n    for (let i = start; i < end; i++) {\n      const c = oldCh[i]\n      if (isDef(c) && sameVnode(node, c)) return i\n    }\n  }\n\n  function patchVnode(\n    oldVnode,\n    vnode,\n    insertedVnodeQueue,\n    ownerArray,\n    index,\n    removeOnly\n  ) {\n    if (oldVnode === vnode) {\n      return\n    }\n\n    if (isDef(vnode.elm) && isDef(ownerArray)) {\n      // clone reused vnode\n      vnode = ownerArray[index] = cloneVNode(vnode)\n    }\n\n    const elm = vnode.elm = oldVnode.elm\n\n    if (isTrue(oldVnode.isAsyncPlaceholder)) {\n      if (isDef(vnode.asyncFactory.resolved)) {\n        hydrate(oldVnode.elm, vnode, insertedVnodeQueue)\n      } else {\n        vnode.isAsyncPlaceholder = true\n      }\n      return\n    }\n\n    // reuse element for static trees.\n    // note we only do this if the vnode is cloned -\n    // if the new node is not cloned it means the render functions have been\n    // reset by the hot-reload-api and we need to do a proper re-render.\n    if (isTrue(vnode.isStatic) &&\n      isTrue(oldVnode.isStatic) &&\n      vnode.key === oldVnode.key &&\n      (isTrue(vnode.isCloned) || isTrue(vnode.isOnce))\n    ) {\n      vnode.componentInstance = oldVnode.componentInstance\n      return\n    }\n\n    let i\n    const data = vnode.data\n    if (isDef(data) && isDef(i = data.hook) && isDef(i = i.prepatch)) {\n      i(oldVnode, vnode)\n    }\n\n    const oldCh = oldVnode.children\n    const ch = vnode.children\n\n    if (isDef(data) && isPatchable(vnode)) {\n      for (i = 0; i < cbs.update.length; ++i) cbs.update[i](oldVnode, vnode)\n      if (isDef(i = data.hook) && isDef(i = i.update)) i(oldVnode, vnode)\n    }\n\n\n    if (isUndef(vnode.text)) {\n      if (isDef(oldCh) && isDef(ch)) {\n        if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly)\n      } else if (isDef(ch)) {\n        if (process.env.NODE_ENV !== 'production') {\n          checkDuplicateKeys(ch)\n        }\n        if (isDef(oldVnode.text)) nodeOps.setTextContent(elm, '')\n        addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue)\n      } else if (isDef(oldCh)) {\n        removeVnodes(elm, oldCh, 0, oldCh.length - 1)\n      } else if (isDef(oldVnode.text)) {\n        nodeOps.setTextContent(elm, '')\n      }\n    } else if (oldVnode.text !== vnode.text) {\n      nodeOps.setTextContent(elm, vnode.text)\n    }\n    if (isDef(data)) {\n      if (isDef(i = data.hook) && isDef(i = i.postpatch)) i(oldVnode, vnode)\n    }\n  }\n\n  function invokeInsertHook(vnode, queue, initial) {\n    // delay insert hooks for component root nodes, invoke them after the\n    // element is really inserted\n    if (isTrue(initial) && isDef(vnode.parent)) {\n      vnode.parent.data.pendingInsert = queue\n    } else {\n      for (let i = 0; i < queue.length; ++i) {\n        queue[i].data.hook.insert(queue[i])\n      }\n    }\n  }\n\n  let hydrationBailed = false\n  // list of modules that can skip create hook during hydration because they\n  // are already rendered on the client or has no need for initialization\n  // Note: style is excluded because it relies on initial clone for future\n  // deep updates (#7063).\n  const isRenderedModule = makeMap('attrs,class,staticClass,staticStyle,key')\n\n  // Note: this is a browser-only function so we can assume elms are DOM nodes.\n  function hydrate(elm, vnode, insertedVnodeQueue, inVPre) {\n    let i\n    const {tag, data, children} = vnode\n    inVPre = inVPre || (data && data.pre)\n    vnode.elm = elm\n\n    if (isTrue(vnode.isComment) && isDef(vnode.asyncFactory)) {\n      vnode.isAsyncPlaceholder = true\n      return true\n    }\n    // assert node match\n    if (process.env.NODE_ENV !== 'production') {\n      if (!assertNodeMatch(elm, vnode, inVPre)) {\n        return false\n      }\n    }\n    if (isDef(data)) {\n      if (isDef(i = data.hook) && isDef(i = i.init)) i(vnode, true /* hydrating */)\n      if (isDef(i = vnode.componentInstance)) {\n        // child component. it should have hydrated its own tree.\n        initComponent(vnode, insertedVnodeQueue)\n        return true\n      }\n    }\n    if (isDef(tag)) {\n      if (isDef(children)) {\n        // empty element, allow client to pick up and populate children\n        if (!elm.hasChildNodes()) {\n          createChildren(vnode, children, insertedVnodeQueue)\n        } else {\n          // v-html and domProps: innerHTML\n          if (isDef(i = data) && isDef(i = i.domProps) && isDef(i = i.innerHTML)) {\n            if (i !== elm.innerHTML) {\n              /* istanbul ignore if */\n              if (process.env.NODE_ENV !== 'production' &&\n                typeof console !== 'undefined' &&\n                !hydrationBailed\n              ) {\n                hydrationBailed = true\n                console.warn('Parent: ', elm)\n                console.warn('server innerHTML: ', i)\n                console.warn('client innerHTML: ', elm.innerHTML)\n              }\n              return false\n            }\n          } else {\n            // iterate and compare children lists\n            let childrenMatch = true\n            let childNode = elm.firstChild\n            for (let i = 0; i < children.length; i++) {\n              if (!childNode || !hydrate(childNode, children[i], insertedVnodeQueue, inVPre)) {\n                childrenMatch = false\n                break\n              }\n              childNode = childNode.nextSibling\n            }\n            // if childNode is not null, it means the actual childNodes list is\n            // longer than the virtual children list.\n            if (!childrenMatch || childNode) {\n              /* istanbul ignore if */\n              if (process.env.NODE_ENV !== 'production' &&\n                typeof console !== 'undefined' &&\n                !hydrationBailed\n              ) {\n                hydrationBailed = true\n                console.warn('Parent: ', elm)\n                console.warn('Mismatching childNodes vs. VNodes: ', elm.childNodes, children)\n              }\n              return false\n            }\n          }\n        }\n      }\n      if (isDef(data)) {\n        let fullInvoke = false\n        for (const key in data) {\n          if (!isRenderedModule(key)) {\n            fullInvoke = true\n            invokeCreateHooks(vnode, insertedVnodeQueue)\n            break\n          }\n        }\n        if (!fullInvoke && data['class']) {\n          // ensure collecting deps for deep class bindings for future updates\n          traverse(data['class'])\n        }\n      }\n    } else if (elm.data !== vnode.text) {\n      elm.data = vnode.text\n    }\n    return true\n  }\n\n  function assertNodeMatch(node, vnode, inVPre) {\n    if (isDef(vnode.tag)) {\n      return vnode.tag.indexOf('vue-component') === 0 || (\n        !isUnknownElement(vnode, inVPre) &&\n        vnode.tag.toLowerCase() === (node.tagName && node.tagName.toLowerCase())\n      )\n    } else {\n      return node.nodeType === (vnode.isComment ? 8 : 3)\n    }\n  }\n\n  return function patch(oldVnode, vnode, hydrating, removeOnly) {\n    if (isUndef(vnode)) {\n      if (isDef(oldVnode)) invokeDestroyHook(oldVnode)\n      return\n    }\n\n    let isInitialPatch = false\n    const insertedVnodeQueue = []\n\n    if (isUndef(oldVnode)) {\n      // empty mount (likely as component), create new root element\n      isInitialPatch = true\n      createElm(vnode, insertedVnodeQueue)\n    } else {\n      const isRealElement = isDef(oldVnode.nodeType)\n      if (!isRealElement && sameVnode(oldVnode, vnode)) {\n        // patch existing root node\n        patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly)\n      } else {\n        if (isRealElement) {\n          // mounting to a real element\n          // check if this is server-rendered content and if we can perform\n          // a successful hydration.\n          if (oldVnode.nodeType === 1 && oldVnode.hasAttribute(SSR_ATTR)) {\n            oldVnode.removeAttribute(SSR_ATTR)\n            hydrating = true\n          }\n          if (isTrue(hydrating)) {\n            if (hydrate(oldVnode, vnode, insertedVnodeQueue)) {\n              invokeInsertHook(vnode, insertedVnodeQueue, true)\n              return oldVnode\n            } else if (process.env.NODE_ENV !== 'production') {\n              warn(\n                'The client-side rendered virtual DOM tree is not matching ' +\n                'server-rendered content. This is likely caused by incorrect ' +\n                'HTML markup, for example nesting block-level elements inside ' +\n                '<p>, or missing <tbody>. Bailing hydration and performing ' +\n                'full client-side render.'\n              )\n            }\n          }\n          // either not server-rendered, or hydration failed.\n          // create an empty node and replace it\n          oldVnode = emptyNodeAt(oldVnode)\n        }\n\n        // replacing existing element\n        const oldElm = oldVnode.elm\n        const parentElm = nodeOps.parentNode(oldElm)\n\n        // create new node\n        createElm(\n          vnode,\n          insertedVnodeQueue,\n          // extremely rare edge case: do not insert if old element is in a\n          // leaving transition. Only happens when combining transition +\n          // keep-alive + HOCs. (#4590)\n          oldElm._leaveCb ? null : parentElm,\n          nodeOps.nextSibling(oldElm)\n        )\n\n        // update parent placeholder node element, recursively\n        if (isDef(vnode.parent)) {\n          let ancestor = vnode.parent\n          const patchable = isPatchable(vnode)\n          while (ancestor) {\n            for (let i = 0; i < cbs.destroy.length; ++i) {\n              cbs.destroy[i](ancestor)\n            }\n            ancestor.elm = vnode.elm\n            if (patchable) {\n              for (let i = 0; i < cbs.create.length; ++i) {\n                cbs.create[i](emptyNode, ancestor)\n              }\n              // #6513\n              // invoke insert hooks that may have been merged by create hooks.\n              // e.g. for directives that uses the \"inserted\" hook.\n              const insert = ancestor.data.hook.insert\n              if (insert.merged) {\n                // start at index 1 to avoid re-invoking component mounted hook\n                for (let i = 1; i < insert.fns.length; i++) {\n                  insert.fns[i]()\n                }\n              }\n            } else {\n              registerRef(ancestor)\n            }\n            ancestor = ancestor.parent\n          }\n        }\n\n        // destroy old node\n        if (isDef(parentElm)) {\n          removeVnodes(parentElm, [oldVnode], 0, 0)\n        } else if (isDef(oldVnode.tag)) {\n          invokeDestroyHook(oldVnode)\n        }\n      }\n    }\n\n    invokeInsertHook(vnode, insertedVnodeQueue, isInitialPatch)\n    return vnode.elm\n  }\n}\n"]}]}